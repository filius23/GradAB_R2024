## ----setup03, echo = F, include=FALSE--------------------------------------------------------------------------------------------------------------------------------
if(Sys.getenv("USERNAME") == "filse" ) path <- "D:/uolCloud//RFS/"
knitr::opts_chunk$set(collapse = F)
library(tidyverse)
 a14 <- readr::read_delim(paste0(path,"allbus_kumuliert.csv"), delim = ";", col_types = cols(.default = col_double())) %>% 
   filter(year == 2014) # for Gini illustration
pend <- haven::read_dta("./orig/PENDDAT_cf_W13.dta")
library(Statamarkdown)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
#| eval: false
## fdz_install("haven") # if not already installed


## ----W04_1, eval=F, echo = T-----------------------------------------------------------------------------------------------------------------------------------------
## library(haven) # data import for Stata datasets
## library(tidyverse) # tidyverse
## pend <- read_dta("./orig/PENDDAT_cf_W13.dta")


## ----W04_2, include=T, echo = T--------------------------------------------------------------------------------------------------------------------------------------
table(pend$statakt)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
attributes(pend$statakt)$labels

## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
#| echo: false
t1 <- table(pend$statakt)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>% count(statakt)


## ----W04_3, include=T, echo = T--------------------------------------------------------------------------------------------------------------------------------------
t1 <- table(pend$statakt)
t2 <- pend %>% count(statakt)


## ----W04class, include=T, echo = T-----------------------------------------------------------------------------------------------------------------------------------
class(t1)
class(t2)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend$statakt[pend$statakt == -5] # only call statakt = -5


## ----W04_3miss, include=T, echo = T----------------------------------------------------------------------------------------------------------------------------------
pend$statakt[pend$statakt == -5]  <- NA


## ----eval = F--------------------------------------------------------------------------------------------------------------------------------------------------------
## pend$statakt[pend$statakt == -9 ]  <- NA
## pend$statakt[pend$statakt == -10]  <- NA


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend$statakt[pend$statakt < 0 ]  <- NA


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>% count(statakt)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>% filter(!is.na(statakt)) %>% count(statakt)


## set linesize 80
## qui use "D:/uolCloud/Home-Cloud\Lehre\R_IAB\orig/PENDDAT_cf_W13.dta", clear
## label lang en
## qui replace statakt = . if statakt < 0
## tab statakt

## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
tab1 <- pend %>% filter(!is.na(statakt)) %>% count(statakt)


## ----W04_5, include=T, echo = T--------------------------------------------------------------------------------------------------------------------------------------
tab1$pct <- prop.table(tab1$n) 
tab1


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
tab1$cum <- prop.table(tab1$n) %>% cumsum()
tab1

## ----echo=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------
t2x <- cumsum(prop.table(table(pend$statakt)))


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>% count(zpsex, statakt)
tab2 <- pend %>% count(zpsex, statakt)
tab2$pct <- prop.table(tab2$n)
tab2


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
summary(pend$netges)
pend$netges[pend$netges < 0] <- NA # Handling Missing Data
summary(pend$netges)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
mean(pend$netges)
mean(pend$netges, na.rm = TRUE)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>%
  summarise(
    Minimum = min(netges, na.rm = TRUE),
    Median = median(netges, na.rm = TRUE),
    Mean = mean(netges, na.rm = TRUE),
    Maximum = max(netges, na.rm = TRUE)
  )


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>%
  summarise(
    Minimum = min(netges, na.rm = TRUE),
    Median = median(netges, na.rm = TRUE),
    Mean = mean(netges, na.rm = TRUE),
    Maximum = max(netges, na.rm = TRUE),
    .by = welle
  ) %>% arrange(welle)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
pend %>% 
  filter(welle %in% c(1, 10)) %>% 
  summarise(
    Minimum = min(netges, na.rm = TRUE),
    Median = median(netges, na.rm = TRUE),
    Mean = mean(netges, na.rm = TRUE),
    Maximum = max(netges, na.rm = TRUE),
    .by = welle
  )


## ----einls, eval=F, echo = T-----------------------------------------------------------------------------------------------------------------------------------------
## library(haven)
## pend <- read_dta("./orig/PENDDAT_cf_W13.dta")


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
#| echo: false
# table(pend$famstand)
library(gt)
pend %>% count(famstand) %>% 
  mutate(label = haven::as_factor(famstand)) %>% 
  select(-n) %>% gt() %>% tab_options(  table.font.size = 9)
# %>% kable(.) %>% 
#   kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F) %>% 
#   row_spec(0, color = "white",font_size = 0)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
#| eval: false
## pend$palter[pend$palter<0] <- NA
## pend$famstand[pend$famstand<0] <- NA


## ----W04_9, include=T, echo = T--------------------------------------------------------------------------------------------------------------------------------------
round(21.12121123,digits = 3)
round(21.12121123,digits = 5)
round(21.12121123,digits = 0)


## --------------------------------------------------------------------------------------------------------------------------------------------------------------------
xtabs(~zpsex+statakt, data = pend) %>% 
  prop.table(.,margin = 1) %>% 
  round(.,3)


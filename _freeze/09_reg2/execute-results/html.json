{
  "hash": "5b024a5f10acd8ed59a6fd5e8f8c2e74",
  "result": {
    "engine": "knitr",
    "markdown": "# Regression Models: Extensions\n\n\n\n\n\n\n\n\n\nAfter covering the basics of regression models, this chapter explores some useful extensions of regression models in R.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\ndat1 <- data.frame(id = 1:8,\n                   var1 = c(2,1,2,5,7,8,9,5),\n                   var2 = c(2,2,1,9,7,4,25,3),\n                   educ = c(3,1,2,2,1,3,2,-1),\n                   gend = c(2,1,1,2,1,2,1,2),\n                   x = c(2,1,2,4,1,NA,NA,NA))\ndat1$ed_fct <- factor(dat1$educ, levels = 1:3,\n                        labels = c(\"basic\",\"medium\",\"high\"))\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n\n\n:::\n:::\n\n\n\n\n+ [Complete rows with `complete.cases()`](#complcses) -> `e(sample)` in Stata\n+ [Interactions](#inter) -> `c.var1##c.var2` in Stata\n+ [Quadratic Terms](#quad) -> `c.var1##c.var1` in Stata\n+ [Applying Weights](#gew) \n+ [Robust Standard Errors](#rbst)\n+ [Fixed Effects Models](#fe)\n+ [Multilevel Models](#mlvl)\n\n## Keeping Only Complete Rows {#complcses}\n\nWhen we compare models `m1` and `m3`, we see different sample sizes:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- lm(var2 ~ var1, data = dat1)  \nm4 <- lm(var2 ~ ed_fct + var1, data = dat1)\nmodelsummary(list(\"m1\"=m1,\"m4\"=m4), gof_omit = \"IC|RM|Log|F\", output = \"flextable\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-afe0c352{}.cl-afd2e85e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-afd712e4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-afd73d50{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-afd73d5a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-afd73d64{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-afd73d65{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-afe0c352'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-afd73d50\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"> </span></p></th><th class=\"cl-afd73d50\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">m1</span></p></th><th class=\"cl-afd73d50\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(Intercept)</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">-2.340</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(4.345)</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">var1</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">1.839</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(0.773)</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">ed_fctmedium</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">ed_fcthigh</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\"></span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d64\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">Num.Obs.</span></p></td><td class=\"cl-afd73d64\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">8</span></p></td><td class=\"cl-afd73d64\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">R2</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">0.486</span></p></td><td class=\"cl-afd73d5a\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-afd73d65\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">R2 Adj.</span></p></td><td class=\"cl-afd73d65\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">0.400</span></p></td><td class=\"cl-afd73d65\"><p class=\"cl-afd712e4\"><span class=\"cl-afd2e85e\">0.400</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\nIt appears that in model `m4`, one case is lost with `ed_fct`. Why is that? It’s worth taking a look at the data:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct\n1  1    2    2    3    2  2   high\n2  2    1    2    1    1  1  basic\n3  3    2    1    2    1  2 medium\n4  4    5    9    2    2  4 medium\n5  5    7    7    1    1  1  basic\n6  6    8    4    3    2 NA   high\n7  7    9   25    2    1 NA medium\n8  8    5    3   -1    2 NA   <NA>\n```\n\n\n:::\n:::\n\n\n\n\nThe value for `ed_fct` is missing for `id` = 8.\n\nTo compare the models, we should use only the rows where `ed_fct` values are available. We can manually select these rows (excluding `id`=8), but this can be cumbersome with larger datasets.\n\n### `complete.cases()`\n\nHere, `complete.cases()` is helpful. This function creates a logical variable that is `TRUE` for all complete cases (i.e., without `NA`). Incomplete cases are marked as `FALSE`. We specify which variables to consider for this check and add the variable to the dataset as a new column. For model 1, a case is considered `complete` if both `var2` and `var1` are present. So, we select the relevant variables with `select()` and apply `complete.cases` to this selection:\n\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% select(var1, var2) %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\ndat1$compl_m1 <- dat1 %>% select(var1, var2) %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct compl_m1\n1  1    2    2    3    2  2   high     TRUE\n2  2    1    2    1    1  1  basic     TRUE\n3  3    2    1    2    1  2 medium     TRUE\n4  4    5    9    2    2  4 medium     TRUE\n5  5    7    7    1    1  1  basic     TRUE\n6  6    8    4    3    2 NA   high     TRUE\n7  7    9   25    2    1 NA medium     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE\n```\n\n\n:::\n:::\n\n\n\n::: {.callout-warning collapse=\"true\"}\n# `complete.cases()` alone searches for `NA` in all variables\nNote: if we do not specify variables, `NA` will be considered from all variables, including `x`, which we are not interested in here:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% complete.cases(.) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE\n```\n\n\n:::\n\n```{.r .cell-code}\ndat1$compl <- dat1 %>% complete.cases(.) \ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl\n1  1    2    2    3    2  2   high     TRUE  TRUE\n2  2    1    2    1    1  1  basic     TRUE  TRUE\n3  3    2    1    2    1  2 medium     TRUE  TRUE\n4  4    5    9    2    2  4 medium     TRUE  TRUE\n5  5    7    7    1    1  1  basic     TRUE  TRUE\n6  6    8    4    3    2 NA   high     TRUE FALSE\n7  7    9   25    2    1 NA medium     TRUE FALSE\n8  8    5    3   -1    2 NA   <NA>     TRUE FALSE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n:::\n\nWe do the same for model `m4`, which includes `ed_fct` in addition to `var2` and `var1`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$compl_m4 <- dat1 %>% select(var1, var2, ed_fct) %>% complete.cases(.)\n```\n:::\n\n\n\n\nHere’s how it looks in the dataset:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  1    2    2    3    2  2   high     TRUE     TRUE\n2  2    1    2    1    1  1  basic     TRUE     TRUE\n3  3    2    1    2    1  2 medium     TRUE     TRUE\n4  4    5    9    2    2  4 medium     TRUE     TRUE\n5  5    7    7    1    1  1  basic     TRUE     TRUE\n6  6    8    4    3    2 NA   high     TRUE     TRUE\n7  7    9   25    2    1 NA medium     TRUE     TRUE\n8  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n\n\n:::\n:::\n\n\n\n\n### Finding Cases with Missing Values\n\nNow, we can filter by these variables and examine these cases more closely. We filter for cases that are included in `m1` (i.e., `compl_m1` = `TRUE`) but not in `m4` (`compl_m4` = `FALSE`):\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 %>% filter(compl_m1 == T & compl_m4 == F) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  id var1 var2 educ gend  x ed_fct compl_m1 compl_m4\n1  8    5    3   -1    2 NA   <NA>     TRUE    FALSE\n```\n\n\n:::\n:::\n\n\n\n\n### Calculating Models with Only Complete Cases\n\nWe can now create model `m1` to include only cases that are also considered in model `m4`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1_m4vars <- lm(var2 ~ var1, data = filter(dat1, compl_m4 == T))\nmodelsummary(list(\"m1\"=m1,\"m1 with m4vars\"=m1_m4vars,\"m4\"=m4), gof_omit = \"IC|RM|Log|F\", output = \"flextable\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-b360e85e{}.cl-b354808c{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-b358d100{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-b358f22a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b358f234{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b358f23e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 1pt solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-b358f23f{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-b360e85e'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-b358f22a\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"> </span></p></th><th class=\"cl-b358f22a\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">m1</span></p></th><th class=\"cl-b358f22a\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">m1 with m4vars</span></p></th><th class=\"cl-b358f22a\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">m4</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(Intercept)</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">-2.340</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">-1.832</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">-2.511</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(4.345)</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(4.646)</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(5.681)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">var1</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">1.839</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">1.848</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">1.753</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(0.773)</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(0.814)</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(0.835)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">ed_fctmedium</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">4.830</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(6.038)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">ed_fcthigh</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">-3.253</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\"></span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">(6.554)</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f23e\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">Num.Obs.</span></p></td><td class=\"cl-b358f23e\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">8</span></p></td><td class=\"cl-b358f23e\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">7</span></p></td><td class=\"cl-b358f23e\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">7</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">R2</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.486</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.508</span></p></td><td class=\"cl-b358f234\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.700</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-b358f23f\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">R2 Adj.</span></p></td><td class=\"cl-b358f23f\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.400</span></p></td><td class=\"cl-b358f23f\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.409</span></p></td><td class=\"cl-b358f23f\"><p class=\"cl-b358d100\"><span class=\"cl-b354808c\">0.400</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\nNow, both `m1 with m4vars` and `m4` have the same number of cases, allowing for a direct comparison of the results.\n\n## Interactions {#inter}\n\nInteractions between two variables can be calculated using `*`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1$g_fct <- factor(dat1$gend, levels = 1:2,\n                     labels = c(\"women\",\"men\"))\nm5 <- lm(var2 ~ var1 * g_fct, data = dat1)\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n\n\n:::\n:::\n\n\n\n`avg_slopes()` from `{marginaleffects}` helps to calculate the marginal effects/slopes of a one-unit increase in `var1` for each subgroup of `g_fct`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_slopes(m5,\n           variables = \"var1\",\n           by = \"g_fct\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n g_fct Estimate Std. Error     z Pr(>|z|)   S  2.5 % 97.5 %\n women    2.497      0.821 3.041  0.00236 8.7  0.888   4.11\n men      0.333      1.295 0.257  0.79684 0.3 -2.204   2.87\n\nTerm: var1\nType:  response \nComparison: mean(dY/dX)\nColumns: term, contrast, g_fct, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted \n```\n\n\n:::\n:::\n\n\n\n\nInteractions should always be visualized. `plot_predictions()` from `{marginaleffects}` is a very helpful function to plot the predicted values :\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(m5, condition = c(\"var1\", \"g_fct\"))\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-15-1.png){width=80% height=60%}\n:::\n:::\n\n\n\n\nWe can modify this plot using familiar `{ggplot2}` commands:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(m5, condition = c(\"var1\", \"g_fct\")) + \n  scale_color_manual(values = c(\"orange\",\"lightskyblue3\"), breaks = c(\"women\",\"men\"), labels=c(\"Women\",\"Men\")) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"), breaks = c(\"women\",\"men\"), labels=c(\"Women\",\"Men\")) +\n  labs(title = \"Predicted Values for var2\",\n       color = \"Gender\", fill = \"Gender\",\n       x = \"Values for var1\",\n       y = \"Predicted Values for var1\")\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-16-1.png){width=60% height=60%}\n:::\n:::\n\n\n\n**[Alternatively, we can create the \"marginsplot\" step by step ourselves](#marginsplot)**\n\n## Quadratic Terms & Polynomials {#quad}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm6 <- lm(var2 ~ var1 + I(var1^2), data = dat1 %>% filter(id != 7))\nsummary(m6)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = var2 ~ var1 + I(var1^2), data = dat1 %>% filter(id != \n    7))\n\nResiduals:\n      1       2       3       4       5       6       7 \n-0.5443  1.4334 -1.5443  3.2043  1.2713 -1.0248 -2.7957 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)\n(Intercept)  -1.8580     3.4066  -0.545    0.614\nvar1          2.6481     1.9083   1.388    0.238\nI(var1^2)    -0.2235     0.2110  -1.059    0.349\n\nResidual standard error: 2.524 on 4 degrees of freedom\nMultiple R-squared:  0.5099,\tAdjusted R-squared:  0.2648 \nF-statistic: 2.081 on 2 and 4 DF,  p-value: 0.2402\n```\n\n\n:::\n:::\n\n\n\n\nAgain, `{marginaleffects}` provides a helpful function to visualize the shape of predicted values:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_predictions(m6, condition = \"var1\") # conditional adjusted predictions \n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-19-1.png){width=60% height=60%}\n:::\n\n```{.r .cell-code}\nplot_slopes(m6, variables = \"var1\", condition = \"var1\") # conditional marginal effects\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-19-2.png){width=60% height=60%}\n:::\n:::\n\n\n\n\n## Logistic regression model\n\n\n\n\n\n\n\n\nFor binary dependent variables, logistic regression models are a widely used tool. \nWe can fit logistic regression models in R using `glm()` - for an example, we turn to `PSM0100` (Usage of social networks yes = 1, no = 2) :\n\n\\begin{equation*}\n\\widehat{Logit(soc\\_med=1)} = \\widehat{ln\\left(\\frac{P(soc\\_med=1)}{1-P(soc\\_med=1)}\\right)} = \\hat\\beta0 + \\hat{\\beta1}\\times \\texttt{palter}\n\\end{equation*}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npend10 <- haven::read_dta(\"./orig/PENDDAT_cf_W13.dta\",\n                          col_select = c(\"palter\",\"PSM0100\")) %>% \n  filter(PSM0100>0) %>% \n  mutate(soc_med = 2- PSM0100)  # convert into 0/1 dummy variable\n\npend10 %>% count(soc_med,PSM0100) # check: soc_med = 1 -> yes, soc_med = 0 -> no\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  soc_med PSM0100       n\n    <dbl> <dbl+lbl> <int>\n1       0 2 [No]     2873\n2       1 1 [Yes]    2589\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nm2 <- glm(soc_med ~ palter, family = \"binomial\", data = pend10)\nsummary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = soc_med ~ palter, family = \"binomial\", data = pend10)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  3.194321   0.107660   29.67   <2e-16 ***\npalter      -0.073518   0.002315  -31.75   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 7557.2  on 5461  degrees of freedom\nResidual deviance: 6217.5  on 5460  degrees of freedom\nAIC: 6221.5\n\nNumber of Fisher Scoring iterations: 3\n```\n\n\n:::\n:::\n\n\n\n\n\nThe interpretation of the $\\beta$ coefficients from a logistic regression model pertains to the logits (the logarithms of the odds):\n*There is a statistically significant relationship at the 0.001 level between age and the probability of using social media. With each additional year of age, there is a decrease of 0.073518 in the *logits* of the respondents using social media.*\n\n\n### average marginal effects\nLogits are quite cumbersome—so how does the *probability* of $\\texttt{soc\\_med} = 1$ change with `palter`? Here, we face the challenge that the derivative of the \"inverse function\" is not as straightforward as in the case of OLS. If we modify the [regression equation from above[^2]](#logmod) with `exp()` and $p=\\frac{Odds}{1+Odds}$, we get:\n\n\\begin{equation*}\n\\widehat{P(soc\\_med=1)} = \\frac{e^{\\hat\\beta0+\\hat\\beta1 \\times \\texttt{palter}}}{1+e^{\\hat\\beta0+\\hat{\\beta1}\\times \\texttt{palter}}}\n\\end{equation*}\n\n[^2]: $\\widehat{Logit(soc\\_med=1)} = \\widehat{ln\\left(\\frac{P(soc\\_med=1)}{1-P(soc\\_med=1)}\\right)} = \\hat\\beta0 + \\hat{\\beta1}\\times \\texttt{palter}$\n\nWe would need to differentiate this expression with respect to `palter` to determine how the predicted probability of $\\texttt{soc\\_med} = 1$ changes with each additional year of respondent age. Given that `palter` appears in both the exponent of the `e` function and both the numerator and denominator (\"top and bottom\"), the differentiation becomes significantly more complex than in the previous `lm()` models.\n\nFor our purposes, it is crucial to note that to compute changes in the predicted probabilities, we need the so-called marginal effects from the `{marginaleffects}` package. This package includes the `avg_slopes()` function, which allows us to calculate a $\\beta$ representing the change in the  _probability_ of $\\texttt{soc\\_med} = 1$ in relation to `palter`. This is known as the *average marginal effect*, as it provides the *average* marginal change in the dependent variable for a one-unit increase in the independent variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdz_install(\"marginaleffects\") # nur einmal nötig\nlibrary(marginaleffects)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\navg_slopes(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n Estimate Std. Error     z Pr(>|z|)   S   2.5 %  97.5 %\n  -0.0142   0.000266 -53.4   <0.001 Inf -0.0147 -0.0137\n\nTerm: palter\nType:  response \nComparison: mean(dY/dX)\nColumns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n*With each additional year of age, there is on average a decrease of 0.01419 (1.419 percentage points) in the probability of using social media.*\n\n\n## Weighted Regression Model {#gew}\n\nThe `{survey}` package allows including weights when fitting regression model:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdz_install(\"survey\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survey)\npend <- haven::read_dta(\"./orig/PENDDAT_cf_W13.dta\") %>% filter(netges > 0 , palter > 0, azges1 > 0) %>% \n  mutate(zpsex_fct = factor(zpsex, levels = 1:2, labels = c(\"M\",\"W\")))\nwgt_df <- haven::read_dta(\"./orig/pweights_cf_W13.dta\")\npend_wgt <- pend %>% left_join(wgt_df, by = join_by(pnr,welle))\n\nmodx <- lm(netges ~ palter + I(palter^2),data=pend) # conventional lm() model\n\n# create new data.frame including weights using svydesign() from survey-package\npend_weighted <- svydesign(id      = ~pnr, # id variable\n                           weights = ~wqp, # weight variable\n                           data    = pend_wgt) # original unweighted data \n\n# family = gaussian() provides a linear regression model, like lm() - but respecting weights\nsurvey_modx <- svyglm(netges ~ palter + I(palter^2), \n                    family = gaussian(), data = etb18,design = pend_weighted)\n\nmodelsummary(list(\"lm()\"=modx,\"svyglm()\"= survey_modx),gof_omit = \"RM|IC|Log\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_31dcq6yjig5i30kh0l1a</title>\n    <style>\n.table td.tinytable_css_o0xxass2m3n9g7gxwv3b, .table th.tinytable_css_o0xxass2m3n9g7gxwv3b {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_h0lshflngczlbu3kz9yi, .table th.tinytable_css_h0lshflngczlbu3kz9yi {    text-align: left; }\n.table td.tinytable_css_5r0uphbsddzna2xiit2l, .table th.tinytable_css_5r0uphbsddzna2xiit2l {    text-align: center; }\n.table td.tinytable_css_tag1bpyl18c5pj063io3, .table th.tinytable_css_tag1bpyl18c5pj063io3 {    text-align: center; }\n.table td.tinytable_css_8xkj8zdfjh4yplydpmwo, .table th.tinytable_css_8xkj8zdfjh4yplydpmwo {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_31dcq6yjig5i30kh0l1a\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">lm()</th>\n                <th scope=\"col\">svyglm()</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>811.753  </td>\n                  <td>463.721  </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(354.363)</td>\n                  <td>(504.015)</td>\n                </tr>\n                <tr>\n                  <td>palter     </td>\n                  <td>24.640   </td>\n                  <td>53.580   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(17.071) </td>\n                  <td>(26.471) </td>\n                </tr>\n                <tr>\n                  <td>I(palter^2)</td>\n                  <td>-0.147   </td>\n                  <td>-0.489   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(0.197)  </td>\n                  <td>(0.314)  </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.   </td>\n                  <td>7996     </td>\n                  <td>7996     </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.004    </td>\n                  <td>0.007    </td>\n                </tr>\n                <tr>\n                  <td>R2 Adj.    </td>\n                  <td>0.004    </td>\n                  <td>-2.252   </td>\n                </tr>\n                <tr>\n                  <td>F          </td>\n                  <td>15.525   </td>\n                  <td>8.495    </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_m8s8yz0nta25iwz0nanb(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_31dcq6yjig5i30kh0l1a\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_31dcq6yjig5i30kh0l1a');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_m8s8yz0nta25iwz0nanb(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_31dcq6yjig5i30kh0l1a\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 0, 'tinytable_css_o0xxass2m3n9g7gxwv3b') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 1, 'tinytable_css_o0xxass2m3n9g7gxwv3b') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 2, 'tinytable_css_o0xxass2m3n9g7gxwv3b') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(1, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(2, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(3, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(4, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(5, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(7, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(8, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(9, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(10, 0, 'tinytable_css_h0lshflngczlbu3kz9yi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(1, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(2, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(3, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(4, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(5, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(7, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(8, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(9, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(10, 1, 'tinytable_css_5r0uphbsddzna2xiit2l') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(0, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(1, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(2, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(3, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(4, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(5, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(7, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(8, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(9, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(10, 2, 'tinytable_css_tag1bpyl18c5pj063io3') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 0, 'tinytable_css_8xkj8zdfjh4yplydpmwo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 1, 'tinytable_css_8xkj8zdfjh4yplydpmwo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_m8s8yz0nta25iwz0nanb(6, 2, 'tinytable_css_8xkj8zdfjh4yplydpmwo') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\n## \"Robust\" Standard Errors {#rbst}\n\nOften, standard errors need to be adjusted for violations of general assumptions (homoscedasticity, etc.).\n\nThe good news is that R offers several ways to correct standard errors, including with [{sandwich}](http://sandwich.r-forge.r-project.org/articles/sandwich.html) or [{estimatr}](https://declaredesign.org/r/estimatr/articles/getting-started.html).\n\nA very simple option is the correction of standard errors in `{modelsummary}`, which we will look at in more detail:\n\nWe can request *heteroskedasticity-consistent* (HC) \"robust\" standard errors with the `vcov` option `HC` in `modelsummary()`. \nThe help page for `{modelsummary}` provides a [list of all options](https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html#vcov).\n\nOne option is also `stata`, to replicate results from Stata’s `, robust`. [More here](https://declaredesign.org/r/estimatr/articles/stata-wls-hat.html) about the background and differences.\n\nBased on [the data read above](#gew), we can estimate the following model:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod1 <- lm(netges ~ palter + I(palter^2),data=pend) \n\nlibrary(modelsummary)\nmodelsummary(list(mod1,mod1,mod1,mod1),vcov = c(\"classical\",\"HC\",\"HC2\",\"stata\"),gof_omit = \"RM|IC|Log\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_si9qioymq3y8x9qv7e0t</title>\n    <style>\n.table td.tinytable_css_yyt5bmqzowgh2leoebf9, .table th.tinytable_css_yyt5bmqzowgh2leoebf9 {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_tmewrxfglxmpvz2kq4gv, .table th.tinytable_css_tmewrxfglxmpvz2kq4gv {    text-align: left; }\n.table td.tinytable_css_147sci75io6zlrlov6c5, .table th.tinytable_css_147sci75io6zlrlov6c5 {    text-align: center; }\n.table td.tinytable_css_kw0ay6hodwlpzluz02fo, .table th.tinytable_css_kw0ay6hodwlpzluz02fo {    text-align: center; }\n.table td.tinytable_css_3dpl4dbftyipf3bcgzwb, .table th.tinytable_css_3dpl4dbftyipf3bcgzwb {    text-align: center; }\n.table td.tinytable_css_93j6dvfjpf3pbky5kz2p, .table th.tinytable_css_93j6dvfjpf3pbky5kz2p {    text-align: center; }\n.table td.tinytable_css_nczgzc7rr79v8qsu5aye, .table th.tinytable_css_nczgzc7rr79v8qsu5aye {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_si9qioymq3y8x9qv7e0t\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n                <th scope=\"col\">(2)</th>\n                <th scope=\"col\">(3)</th>\n                <th scope=\"col\">(4)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>811.753  </td>\n                  <td>811.753  </td>\n                  <td>811.753  </td>\n                  <td>811.753  </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(354.363)</td>\n                  <td>(171.599)</td>\n                  <td>(171.543)</td>\n                  <td>(171.520)</td>\n                </tr>\n                <tr>\n                  <td>palter     </td>\n                  <td>24.640   </td>\n                  <td>24.640   </td>\n                  <td>24.640   </td>\n                  <td>24.640   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(17.071) </td>\n                  <td>(8.923)  </td>\n                  <td>(8.920)  </td>\n                  <td>(8.919)  </td>\n                </tr>\n                <tr>\n                  <td>I(palter^2)</td>\n                  <td>-0.147   </td>\n                  <td>-0.147   </td>\n                  <td>-0.147   </td>\n                  <td>-0.147   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(0.197)  </td>\n                  <td>(0.112)  </td>\n                  <td>(0.112)  </td>\n                  <td>(0.112)  </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.   </td>\n                  <td>7996     </td>\n                  <td>7996     </td>\n                  <td>7996     </td>\n                  <td>7996     </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                </tr>\n                <tr>\n                  <td>R2 Adj.    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                </tr>\n                <tr>\n                  <td>F          </td>\n                  <td>15.525   </td>\n                  <td>23.449   </td>\n                  <td>23.441   </td>\n                  <td>23.440   </td>\n                </tr>\n                <tr>\n                  <td>Std.Errors </td>\n                  <td>IID      </td>\n                  <td>HC       </td>\n                  <td>HC2      </td>\n                  <td>HC1      </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_b8dznuq738wfgd4ux7ij(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_si9qioymq3y8x9qv7e0t\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_si9qioymq3y8x9qv7e0t');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_b8dznuq738wfgd4ux7ij(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_si9qioymq3y8x9qv7e0t\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 0, 'tinytable_css_yyt5bmqzowgh2leoebf9') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 1, 'tinytable_css_yyt5bmqzowgh2leoebf9') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 2, 'tinytable_css_yyt5bmqzowgh2leoebf9') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 3, 'tinytable_css_yyt5bmqzowgh2leoebf9') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 4, 'tinytable_css_yyt5bmqzowgh2leoebf9') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(1, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(2, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(3, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(4, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(5, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(7, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(8, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(9, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(10, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(11, 0, 'tinytable_css_tmewrxfglxmpvz2kq4gv') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(1, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(2, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(3, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(4, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(5, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(7, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(8, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(9, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(10, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(11, 1, 'tinytable_css_147sci75io6zlrlov6c5') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(1, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(2, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(3, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(4, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(5, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(7, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(8, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(9, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(10, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(11, 2, 'tinytable_css_kw0ay6hodwlpzluz02fo') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(1, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(2, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(3, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(4, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(5, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(7, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(8, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(9, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(10, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(11, 3, 'tinytable_css_3dpl4dbftyipf3bcgzwb') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(0, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(1, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(2, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(3, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(4, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(5, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(7, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(8, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(9, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(10, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(11, 4, 'tinytable_css_93j6dvfjpf3pbky5kz2p') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 0, 'tinytable_css_nczgzc7rr79v8qsu5aye') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 1, 'tinytable_css_nczgzc7rr79v8qsu5aye') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 2, 'tinytable_css_nczgzc7rr79v8qsu5aye') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 3, 'tinytable_css_nczgzc7rr79v8qsu5aye') })\nwindow.addEventListener('load', function () { styleCell_tinytable_b8dznuq738wfgd4ux7ij(6, 4, 'tinytable_css_nczgzc7rr79v8qsu5aye') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\nFor clustered SEs, we specify `~clustervariable`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(mod1, vcov = c(\"classical\",~pnr), stars = T,gof_omit = \"RM|IC|Log|F\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_v4l177gb0eviob5jk8cg</title>\n    <style>\n.table td.tinytable_css_86kjozctx0iq3r5fumj7, .table th.tinytable_css_86kjozctx0iq3r5fumj7 {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_5mlp0gyfppjr40aj1h5d, .table th.tinytable_css_5mlp0gyfppjr40aj1h5d {    text-align: left; }\n.table td.tinytable_css_kthlw3p2a3f2s9s748jm, .table th.tinytable_css_kthlw3p2a3f2s9s748jm {    text-align: center; }\n.table td.tinytable_css_c1eebk2ebzer9idv4b16, .table th.tinytable_css_c1eebk2ebzer9idv4b16 {    text-align: center; }\n.table td.tinytable_css_ou5sjgykbvw3ymtnrtku, .table th.tinytable_css_ou5sjgykbvw3ymtnrtku {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_v4l177gb0eviob5jk8cg\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n                <th scope=\"col\">(2)</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='3'>+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td>(Intercept)</td>\n                  <td>811.753* </td>\n                  <td>811.753**</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(354.363)</td>\n                  <td>(274.972)</td>\n                </tr>\n                <tr>\n                  <td>palter     </td>\n                  <td>24.640   </td>\n                  <td>24.640+  </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(17.071) </td>\n                  <td>(14.475) </td>\n                </tr>\n                <tr>\n                  <td>I(palter^2)</td>\n                  <td>-0.147   </td>\n                  <td>-0.147   </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(0.197)  </td>\n                  <td>(0.185)  </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.   </td>\n                  <td>7996     </td>\n                  <td>7996     </td>\n                </tr>\n                <tr>\n                  <td>R2         </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                </tr>\n                <tr>\n                  <td>R2 Adj.    </td>\n                  <td>0.004    </td>\n                  <td>0.004    </td>\n                </tr>\n                <tr>\n                  <td>Std.Errors </td>\n                  <td>IID      </td>\n                  <td>by: pnr  </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_7350sdvker0uis4vq9ok(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_v4l177gb0eviob5jk8cg\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_v4l177gb0eviob5jk8cg');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_7350sdvker0uis4vq9ok(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_v4l177gb0eviob5jk8cg\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 0, 'tinytable_css_86kjozctx0iq3r5fumj7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 1, 'tinytable_css_86kjozctx0iq3r5fumj7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 2, 'tinytable_css_86kjozctx0iq3r5fumj7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(1, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(2, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(3, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(4, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(5, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(7, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(8, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(9, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(10, 0, 'tinytable_css_5mlp0gyfppjr40aj1h5d') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(1, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(2, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(3, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(4, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(5, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(7, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(8, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(9, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(10, 1, 'tinytable_css_kthlw3p2a3f2s9s748jm') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(0, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(1, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(2, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(3, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(4, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(5, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(7, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(8, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(9, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(10, 2, 'tinytable_css_c1eebk2ebzer9idv4b16') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 0, 'tinytable_css_ou5sjgykbvw3ymtnrtku') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 1, 'tinytable_css_ou5sjgykbvw3ymtnrtku') })\nwindow.addEventListener('load', function () { styleCell_tinytable_7350sdvker0uis4vq9ok(6, 2, 'tinytable_css_ou5sjgykbvw3ymtnrtku') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\n## Fixed Effects Models with `{fixest}` {#fe}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfdz_install(\"fixest\")\n```\n:::\n\n\n\n\n[`{fixest}`](https://lrberge.github.io/fixest)) offers a wide range of options: [logistic FE models](#10_log_reg.qmd##feglm), multi-dimensional fixed effects, multiway clustering, etc. \nAnd it is very fast, [e.g., faster](https://lrberge.github.io/fixest/#benchmarking) than Stata’s `reghdfe`. \nFor more details, the [vignette](https://lrberge.github.io/fixest/articles/fixest_walkthrough.html) is recommended.\n\nThe central function for estimating linear FE regression models is `feols()` - it works very similarly to `lm()`. \nWe provide a formula following the pattern `dependent variable ~ independent variable(s)`. \nWe simply add the variable that specifies the FEs with `|`:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fixest)\nfe_mod1 <- feols(netges ~ palter + I(palter^2) | pnr, data = pend)\nfe_mod1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996\nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n\n\n:::\n:::\n\n\n\n\n`{fixest}` automatically clusters the standard errors along the FE variable (here `pnr`).\nIf we don’t want that, we can request unclustered SEs with the `se` option `= \"standard\"`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fe_mod1, se = 'standard')\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996\nFixed-effects: pnr: 2,444\nStandard-errors: IID \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  39.896986  3.35392 0.00080209 ***\nI(palter^2)  -0.848429   0.429629 -1.97479 0.04834109 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(fe_mod1, cluster = ~pnr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOLS estimation, Dep. Var.: netges\nObservations: 7,996\nFixed-effects: pnr: 2,444\nStandard-errors: Clustered (pnr) \n              Estimate Std. Error  t value   Pr(>|t|)    \npalter      133.811281  14.558248  9.19144  < 2.2e-16 ***\nI(palter^2)  -0.848429   0.154417 -5.49441 4.3261e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nRMSE: 1,222.2     Adj. R2: 0.513287\n                Within R2: 0.009765\n```\n\n\n:::\n:::\n\n\n\n\n`{modelsummary}` shows the clustered SEs:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodelsummary(fe_mod1,gof_omit = \"R|IC|Log|F\",stars = T)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_z19uwbezscjvj7rz3hm3</title>\n    <style>\n.table td.tinytable_css_bvv2td37u0oh29dj4ydp, .table th.tinytable_css_bvv2td37u0oh29dj4ydp {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_s2unp4byjh8q52s4ohe6, .table th.tinytable_css_s2unp4byjh8q52s4ohe6 {    text-align: left; }\n.table td.tinytable_css_2ac6u9lu8livfauyhxg7, .table th.tinytable_css_2ac6u9lu8livfauyhxg7 {    text-align: center; }\n.table td.tinytable_css_imr4xydvnh3r1rykb0au, .table th.tinytable_css_imr4xydvnh3r1rykb0au {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_z19uwbezscjvj7rz3hm3\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n              </tr>\n        </thead>\n        <tfoot><tr><td colspan='2'>+ p < 0.1, * p < 0.05, ** p < 0.01, *** p < 0.001</td></tr></tfoot>\n        <tbody>\n                <tr>\n                  <td>palter     </td>\n                  <td>133.811***</td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(14.558)  </td>\n                </tr>\n                <tr>\n                  <td>I(palter^2)</td>\n                  <td>-0.848*** </td>\n                </tr>\n                <tr>\n                  <td>           </td>\n                  <td>(0.154)   </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.   </td>\n                  <td>7996      </td>\n                </tr>\n                <tr>\n                  <td>Std.Errors </td>\n                  <td>by: pnr   </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_w426ixi4ootbmnk8spzc(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_z19uwbezscjvj7rz3hm3\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_z19uwbezscjvj7rz3hm3');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_w426ixi4ootbmnk8spzc(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_z19uwbezscjvj7rz3hm3\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(0, 0, 'tinytable_css_bvv2td37u0oh29dj4ydp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(0, 1, 'tinytable_css_bvv2td37u0oh29dj4ydp') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(0, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(1, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(2, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(3, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(4, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(5, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(6, 0, 'tinytable_css_s2unp4byjh8q52s4ohe6') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(0, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(1, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(2, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(3, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(4, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(5, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(6, 1, 'tinytable_css_2ac6u9lu8livfauyhxg7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(4, 0, 'tinytable_css_imr4xydvnh3r1rykb0au') })\nwindow.addEventListener('load', function () { styleCell_tinytable_w426ixi4ootbmnk8spzc(4, 1, 'tinytable_css_imr4xydvnh3r1rykb0au') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\n## Multilevel Models with `{lme4}` {#mlvl}\n\nWith `lmer()`, we can estimate a random intercept model by specifying `( 1 | pnr)`, which indicates that a separate random intercept should be calculated for each `pnr`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lme4)\nml_m3 <- lmer(netges ~ palter + I(palter^2) + ( 1 | pnr), data=pend)\n\nmodelsummary(list(ml_m3),gof_omit = \"R|IC|Log|F\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<!DOCTYPE html> \n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>tinytable_6l7tfnxjgpcwhaf1stha</title>\n    <style>\n.table td.tinytable_css_nn5jje93i72pi23w55fi, .table th.tinytable_css_nn5jje93i72pi23w55fi {    border-bottom: solid 0.1em #d3d8dc; }\n.table td.tinytable_css_a9cbjbh6zs16kkcs57p7, .table th.tinytable_css_a9cbjbh6zs16kkcs57p7 {    text-align: left; }\n.table td.tinytable_css_mprkil70rk67r1vu0yhc, .table th.tinytable_css_mprkil70rk67r1vu0yhc {    text-align: center; }\n.table td.tinytable_css_aig1gl76ugrt31qeeho4, .table th.tinytable_css_aig1gl76ugrt31qeeho4 {    border-bottom: solid 0.05em black; }\n    </style>\n    <script src=\"https://polyfill.io/v3/polyfill.min.js?features=es6\"></script>\n    <script id=\"MathJax-script\" async src=\"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"></script>\n    <script>\n    MathJax = {\n      tex: {\n        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']]\n      },\n      svg: {\n        fontCache: 'global'\n      }\n    };\n    </script>\n  </head>\n\n  <body>\n    <div class=\"container\">\n      <table class=\"table table-borderless\" id=\"tinytable_6l7tfnxjgpcwhaf1stha\" style=\"width: auto; margin-left: auto; margin-right: auto;\" data-quarto-disable-processing='true'>\n        <thead>\n        \n              <tr>\n                <th scope=\"col\"> </th>\n                <th scope=\"col\">(1)</th>\n              </tr>\n        </thead>\n        \n        <tbody>\n                <tr>\n                  <td>(Intercept)       </td>\n                  <td>754.388  </td>\n                </tr>\n                <tr>\n                  <td>                  </td>\n                  <td>(392.459)</td>\n                </tr>\n                <tr>\n                  <td>palter            </td>\n                  <td>18.523   </td>\n                </tr>\n                <tr>\n                  <td>                  </td>\n                  <td>(19.083) </td>\n                </tr>\n                <tr>\n                  <td>I(palter^2)       </td>\n                  <td>-0.020   </td>\n                </tr>\n                <tr>\n                  <td>                  </td>\n                  <td>(0.222)  </td>\n                </tr>\n                <tr>\n                  <td>SD (Intercept pnr)</td>\n                  <td>1327.674 </td>\n                </tr>\n                <tr>\n                  <td>SD (Observations) </td>\n                  <td>1414.455 </td>\n                </tr>\n                <tr>\n                  <td>Num.Obs.          </td>\n                  <td>7996     </td>\n                </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <script>\n      function styleCell_tinytable_9l7on3grqxzsh2d0nil6(i, j, css_id) {\n        var table = document.getElementById(\"tinytable_6l7tfnxjgpcwhaf1stha\");\n        table.rows[i].cells[j].classList.add(css_id);\n      }\n      function insertSpanRow(i, colspan, content) {\n        var table = document.getElementById('tinytable_6l7tfnxjgpcwhaf1stha');\n        var newRow = table.insertRow(i);\n        var newCell = newRow.insertCell(0);\n        newCell.setAttribute(\"colspan\", colspan);\n        // newCell.innerText = content;\n        // this may be unsafe, but innerText does not interpret <br>\n        newCell.innerHTML = content;\n      }\n      function spanCell_tinytable_9l7on3grqxzsh2d0nil6(i, j, rowspan, colspan) {\n        var table = document.getElementById(\"tinytable_6l7tfnxjgpcwhaf1stha\");\n        const targetRow = table.rows[i];\n        const targetCell = targetRow.cells[j];\n        for (let r = 0; r < rowspan; r++) {\n          // Only start deleting cells to the right for the first row (r == 0)\n          if (r === 0) {\n            // Delete cells to the right of the target cell in the first row\n            for (let c = colspan - 1; c > 0; c--) {\n              if (table.rows[i + r].cells[j + c]) {\n                table.rows[i + r].deleteCell(j + c);\n              }\n            }\n          }\n          // For rows below the first, delete starting from the target column\n          if (r > 0) {\n            for (let c = colspan - 1; c >= 0; c--) {\n              if (table.rows[i + r] && table.rows[i + r].cells[j]) {\n                table.rows[i + r].deleteCell(j);\n              }\n            }\n          }\n        }\n        // Set rowspan and colspan of the target cell\n        targetCell.rowSpan = rowspan;\n        targetCell.colSpan = colspan;\n      }\n\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(0, 0, 'tinytable_css_nn5jje93i72pi23w55fi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(0, 1, 'tinytable_css_nn5jje93i72pi23w55fi') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(0, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(1, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(2, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(3, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(4, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(5, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(6, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(7, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(8, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(9, 0, 'tinytable_css_a9cbjbh6zs16kkcs57p7') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(0, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(1, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(2, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(3, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(4, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(5, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(6, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(7, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(8, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(9, 1, 'tinytable_css_mprkil70rk67r1vu0yhc') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(8, 0, 'tinytable_css_aig1gl76ugrt31qeeho4') })\nwindow.addEventListener('load', function () { styleCell_tinytable_9l7on3grqxzsh2d0nil6(8, 1, 'tinytable_css_aig1gl76ugrt31qeeho4') })\n    </script>\n\n  </body>\n\n</html>\n```\n\n:::\n:::\n\n\n\n\nMore about multilevel models and `{lme4}` in blog posts by [Rense Nieuwenhuis](http://www.rensenieuwenhuis.nl/r-sessions-16-multilevel-model-specification-lme4/) and [Tristan Mahr](https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/).\n\n<!-- ## Final Remarks -->\n\n<!-- In summary, `{fixest}` and `{modelsummary}` allow us to adjust standard errors after the actual model estimation by using the `se` or `cluster` options.  -->\n\n<!-- A [blog post by Grant Mcdermott](https://grantmcdermott.com/better-way-adjust-SEs/) argues in more detail why post-estimation calculation of standard errors (instead of a complete re-estimation of the model) is a good idea - even though it is a very unusual approach for Stata users. -->\n\n<!-- Exact replication of standard errors from other programs (e.g., Stata) is often more difficult than it initially seems.  -->\n<!-- See also the discussion [here](https://github.com/sgaure/lfe/issues/1#issuecomment-530643808)  -->\n<!-- [Detailed vignette](https://lrberge.github.io/fixest/articles/standard_errors.html) on how SEs from other programs can be replicated. -->\n<!-- [Detailed paper](http://sandwich.r-forge.r-project.org/articles/jss_2020.html) by the authors of `{sandwich}` on this topic. -->\n\n<!-- ## Appendix: Predictions with `marginaleffects` and \"Manual\" Visualization {#marginsplot} -->\n\nIn the [Interactions](#interactions) chapter, we estimated the following model:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = var2 ~ var1 * g_fct, data = dat1)\n\nResiduals:\n      1       2       3       4       5       6       7       8 \n-1.5000  2.6145 -0.8827  4.5000 -7.3687 -1.5000  5.6369 -1.5000 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)  \n(Intercept)    -3.1117     4.7702  -0.652   0.5498  \nvar1            2.4972     0.8211   3.041   0.0384 *\ng_fctmen        5.9451     8.4973   0.700   0.5227  \nvar1:g_fctmen  -2.1639     1.5331  -1.411   0.2310  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.493 on 4 degrees of freedom\nMultiple R-squared:  0.7244,\tAdjusted R-squared:  0.5177 \nF-statistic: 3.504 on 3 and 4 DF,  p-value: 0.1286\n```\n\n\n:::\n:::\n\n\n\n\nWith `predictions()` from `{marginaleffects}`, we can calculate predicted values for specific values based on our model.\nWe specify the desired values with a `datagrid()` - which automatically sets other variables to their mean:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create combinations of all values\ndatagrid(var1 = 1:5,\n         g_fct =  c(\"women\",\"men\"),model = m5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   var1 g_fct rowid\n1     1 women     1\n2     1   men     2\n3     2 women     3\n4     2   men     4\n5     3 women     5\n6     3   men     6\n7     4 women     7\n8     4   men     8\n9     5 women     9\n10    5   men    10\n```\n\n\n:::\n:::\n\n\n\n\nWe then provide these values to `predictions()` as `newdata =`:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(marginaleffects)\np <- predictions(m5, \n                 newdata = datagrid(var1 = 1:5,\n                                    g_fct =  c(\"women\",\"men\"))) # ,model = m5 unnecessary since predictions are already specified:\n                 \nhead(data.frame(p))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  rowid   estimate std.error  statistic   p.value   s.value  conf.low conf.high\n1     1 -0.6145251  4.126052 -0.1489378 0.8816027 0.1817994 -8.701438  7.472388\n2     2  3.1666667  5.861938  0.5402082 0.5890535 0.7635295 -8.322520 14.655854\n3     3  1.8826816  3.555532  0.5295076 0.5964533 0.7455188 -5.086034  8.851397\n4     4  3.5000000  4.756978  0.7357612 0.4618760 1.1144224 -5.823506 12.823506\n5     5  4.3798883  3.099641  1.4130307 0.1576467 2.6652332 -1.695297 10.455073\n6     6  3.8333333  3.774624  1.0155536 0.3098420 1.6903954 -3.564794 11.231461\n  var1 g_fct var2\n1    1 women    2\n2    1   men    2\n3    2 women    2\n4    2   men    2\n5    3 women    2\n6    3   men    2\n```\n\n\n:::\n:::\n\n\n\n\nFor `ggplot()`, we use `geom_line()` together with \n\n+ `geom_errorbar()` for a visualization with confidence intervals as error bars \n+ `geom_ribbon()` for confidence intervals as shaded bands (here, we need to set the opacity with `alpha =` and specify the color with `fill=` to color the area). \n\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\npred_plt <- \n    ggplot(data= data.frame(p),\n           aes(x = var1, \n               y =  estimate, \n               ymin = conf.low,ymax = conf.high,\n               color = g_fct)) + \n      geom_line() + \n      scale_color_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Women\",\"Men\")) +\n      labs(title = \"Predicted Values for var2\",\n           color = \"Gender\", fill = \"Gender\",\n           x = \"Values for var1\",\n           y = \"Predicted Values for var2\") +\n      theme_minimal()\n\n# Confidence intervals\npred_plt + \n  geom_point(size = 2.75) +\n  geom_errorbar(width = .1)\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-34-1.png){width=3500}\n:::\n\n```{.r .cell-code}\n# With confidence bands\npred_plt + \n  geom_ribbon(alpha = .1, color = NA,aes(fill = g_fct)) +\n  scale_fill_manual(values = c(\"orange\",\"lightskyblue3\"),breaks = c(\"women\",\"men\"),labels=c(\"Women\",\"Men\")) +\n  labs(title = \"Predicted Values for var2\",\n           color = \"Gender\", fill = \"Gender\",\n           x = \"Values for var1\",\n           y = \"Predicted Values for var2\") +\n      theme_minimal()\n```\n\n::: {.cell-output-display}\n![](09_reg2_files/figure-html/unnamed-chunk-34-2.png){width=3500}\n:::\n:::\n\n\n\n\n## Links\n\n[How to interpret statistical models in R using `{marginaleffects}`](https://marginaleffects.com/) - deep dive into the background of marginal effects, predictions, adjusted predictions, elasticities, ... and how you can fit them using R. Fans of Stata's `margins` should take a look at [a special chapter comparing margins to marginaleffects](https://marginaleffects.com/vignettes/alternative_software.html#stata)",
    "supporting": [
      "09_reg2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}